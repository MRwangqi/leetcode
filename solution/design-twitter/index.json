{
	"titleSlug": "design-twitter",
	"slug": "she-ji-tui-te-by-leetcode-solution",
	"url": "https://leetcode-cn.com/problems/design-twitter/solution/she-ji-tui-te-by-leetcode-solution/",
	"content": "### ğŸ“º è§†é¢‘é¢˜è§£  \n\n![355 è®¾è®¡æ¨ç‰¹-ä»²è€€æ™–.mp4](262540fb-dfbf-4220-a8b9-504f0151d287)\n\n### ğŸ“– æ–‡å­—é¢˜è§£\n\n#### æ–¹æ³•ä¸€ï¼šå“ˆå¸Œè¡¨ + é“¾è¡¨\n\n**æ€è·¯å’Œç®—æ³•**\n\næ ¹æ®é¢˜æ„æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºæ¯ä¸ªæ¨ç‰¹ç”¨æˆ·ï¼Œæˆ‘ä»¬éœ€è¦å­˜å‚¨ä»–å…³æ³¨çš„ç”¨æˆ· `Id`ï¼Œä»¥åŠè‡ªå·±å‘çš„æ¨æ–‡ `Id` çš„é›†åˆï¼Œä¸ºäº†ä½¿æ¯ä¸ªæ“ä½œçš„å¤æ‚åº¦å°½å¯èƒ½çš„ä½ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®æ“ä½œæ¥å†³å®šå­˜å‚¨è¿™äº›ä¿¡æ¯çš„æ•°æ®ç»“æ„ã€‚æ³¨æ„ï¼Œç”±äºé¢˜ç›®ä¸­æ²¡æœ‰è¯´æ˜ç”¨æˆ·çš„ `Id` æ˜¯å¦è¿ç»­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªä»¥ç”¨æˆ· `Id` ä¸ºç´¢å¼•çš„å“ˆå¸Œè¡¨æ¥å­˜å‚¨ç”¨æˆ·çš„ä¿¡æ¯ã€‚\n\nå¯¹äºæ“ä½œ `3` å’Œæ“ä½œ `4`ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ä¸€ä¸ªå“ˆå¸Œè¡¨å­˜å‚¨ï¼Œå³å¯å®ç°æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º $O(1)$ã€‚\n\nå¯¹äºæ“ä½œ `1` å’Œæ“ä½œ `2`ï¼Œç”±äºæ“ä½œ `2` è¦çŸ¥é“æ­¤ç”¨æˆ·å…³æ³¨çš„äººå’Œç”¨æˆ·è‡ªå·±å‘å‡ºçš„æœ€è¿‘åæ¡æ¨æ–‡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å¯¹æ¯ä¸ªç”¨æˆ·ç”¨é“¾è¡¨å­˜å‚¨å‘é€çš„æ¨æ–‡ã€‚æ¯æ¬¡åˆ›å»ºæ¨æ–‡çš„æ—¶å€™æˆ‘ä»¬åœ¨é“¾è¡¨å¤´æ’å…¥ï¼Œè¿™æ ·èƒ½ä¿è¯é“¾è¡¨é‡Œå­˜å‚¨çš„æ¨æ–‡çš„æ—¶é—´æ˜¯ä»æœ€è¿‘åˆ°æœ€ä¹…çš„ã€‚é‚£ä¹ˆå¯¹äºæ“ä½œ `2`ï¼Œé—®é¢˜å…¶å®å°±ç­‰ä»·äºæœ‰è‹¥å¹²ä¸ªæœ‰åºçš„é“¾è¡¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å®ƒä»¬åˆèµ·æ¥æœ€è¿‘çš„åæ¡æ¨æ–‡ã€‚ç”±äºé“¾è¡¨é‡Œå­˜å‚¨çš„æ•°æ®éƒ½æ˜¯æœ‰åºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿™äº›é“¾è¡¨è¿›è¡Œçº¿æ€§å½’å¹¶å³å¯å¾—åˆ°æœ€è¿‘çš„åæ¡æ¨æ–‡ã€‚è¿™ä¸ªæ“ä½œä¸ [23. åˆå¹¶Kä¸ªæ’åºé“¾è¡¨](https://leetcode-cn.com/problems/merge-k-sorted-lists/) åŸºæœ¬ç­‰åŒã€‚\n\n![fig1](https://assets.leetcode-cn.com/solution-static/355_fig1.png)\n\nå¦‚æœæˆ‘ä»¬ç›´æ¥ç…§æ¬ã€Œåˆå¹¶Kä¸ªæ’åºé“¾è¡¨ã€çš„è§£æ³•æ¥è¿›è¡Œåˆå¹¶ï¼Œé‚£ä¹ˆæ— ç–‘ä¼šé€ æˆç©ºé—´çš„éƒ¨åˆ†æµªè´¹ï¼Œå› ä¸ºè¿™ä¸ªé¢˜ç›®ä¸è¦æ±‚ä½ å±•ç¤ºç”¨æˆ·çš„æ‰€æœ‰æ¨æ–‡ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦åŠ¨æ€ç»´æŠ¤ç”¨æˆ·çš„é“¾è¡¨ï¼Œå­˜å‚¨æœ€è¿‘çš„ `recentMax` ä¸ªæ¨æ–‡ `Id` å³å¯ï¼ˆé¢˜ç›®ä¸­çš„ `recentMax` ä¸º `10`ï¼‰ã€‚é‚£ä¹ˆå¯¹äºæ“ä½œ `1`ï¼Œå½“å‘ç°é“¾è¡¨çš„èŠ‚ç‚¹æ•°ç­‰äº `recentMax` æ—¶ï¼Œæˆ‘ä»¬æŒ‰é¢˜æ„åˆ é™¤é“¾è¡¨æœ«å°¾çš„å…ƒç´ ï¼Œå†æ’å…¥æœ€æ–°çš„æ¨æ–‡ `Id`ã€‚å¯¹äºæ“ä½œ `2`ï¼Œåœ¨ä¸¤ä¸ªé“¾è¡¨è¿›è¡Œçº¿æ€§å½’å¹¶çš„æ—¶å€™ï¼Œåªè¦å·²åˆå¹¶çš„æ•°é‡ç­‰äº `recentMax`ï¼Œä»£è¡¨å·²ç»æ‰¾åˆ°è¿™ä¸¤ä¸ªé“¾è¡¨åˆèµ·æ¥åæœ€è¿‘çš„ `recentMax` æ¡æ¨æ–‡ï¼Œç›´æ¥ç»“æŸåˆå¹¶å³å¯ã€‚\n\n```C++ [sol1-C++]\nclass Twitter {\n    struct Node {\n        // å“ˆå¸Œè¡¨å­˜å‚¨å…³æ³¨äººçš„ Id\n        unordered_set<int> followee;\n        // ç”¨é“¾è¡¨å­˜å‚¨ tweetId\n        list<int> tweet;\n    };\n    // getNewsFeed æ£€ç´¢çš„æ¨æ–‡çš„ä¸Šé™ä»¥åŠ tweetId çš„æ—¶é—´æˆ³\n    int recentMax, time;\n    // tweetId å¯¹åº”å‘é€çš„æ—¶é—´\n    unordered_map<int, int> tweetTime;\n    // æ¯ä¸ªç”¨æˆ·å­˜å‚¨çš„ä¿¡æ¯\n    unordered_map<int, Node> user;\npublic:\n    Twitter() {\n        time = 0;\n        recentMax = 10;\n        user.clear();\n    }\n    \n    // åˆå§‹åŒ–\n    void init(int userId) {\n        user[userId].followee.clear();\n        user[userId].tweet.clear();\n    }\n\n    void postTweet(int userId, int tweetId) {\n        if (user.find(userId) == user.end()) {\n            init(userId);\n        }\n        // è¾¾åˆ°é™åˆ¶ï¼Œå‰”é™¤é“¾è¡¨æœ«å°¾å…ƒç´ \n        if (user[userId].tweet.size() == recentMax) {\n            user[userId].tweet.pop_back();\n        }\n        user[userId].tweet.push_front(tweetId);\n        tweetTime[tweetId] = ++time;\n    }\n    \n    vector<int> getNewsFeed(int userId) {\n        vector<int> ans; ans.clear();\n        for (list<int>::iterator it = user[userId].tweet.begin(); it != user[userId].tweet.end(); ++it) {\n            ans.emplace_back(*it);\n        }\n        for (int followeeId: user[userId].followee) {\n            if (followeeId == userId) continue; // å¯èƒ½å‡ºç°è‡ªå·±å…³æ³¨è‡ªå·±çš„æƒ…å†µ\n            vector<int> res; res.clear();\n            list<int>::iterator it = user[followeeId].tweet.begin();\n            int i = 0;\n            // çº¿æ€§å½’å¹¶\n            while (i < (int)ans.size() && it != user[followeeId].tweet.end()) {\n                if (tweetTime[(*it)] > tweetTime[ans[i]]) {\n                    res.emplace_back(*it);\n                    ++it;\n                } else {\n                    res.emplace_back(ans[i]);\n                    ++i;\n                }\n                // å·²ç»æ‰¾åˆ°è¿™ä¸¤ä¸ªé“¾è¡¨åˆèµ·æ¥åæœ€è¿‘çš„ recentMax æ¡æ¨æ–‡\n                if ((int)res.size() == recentMax) break;\n            }\n            for (; i < (int)ans.size() && (int)res.size() < recentMax; ++i) res.emplace_back(ans[i]);\n            for (; it != user[followeeId].tweet.end() && (int)res.size() < recentMax; ++it) res.emplace_back(*it);\n            ans.assign(res.begin(),res.end());\n        }\n        return ans;\n    }\n    \n    void follow(int followerId, int followeeId) {\n        if (user.find(followerId) == user.end()) {\n            init(followerId);\n        }\n        if (user.find(followeeId) == user.end()) {\n            init(followeeId);\n        }\n        user[followerId].followee.insert(followeeId);\n    }\n    \n    void unfollow(int followerId, int followeeId) {\n        user[followerId].followee.erase(followeeId);\n    }\n};\n```\n\n```Java [sol1-Java]\nclass Twitter {\n    private class Node {\n        // å“ˆå¸Œè¡¨å­˜å‚¨å…³æ³¨äººçš„ Id\n        Set<Integer> followee;\n        // ç”¨é“¾è¡¨å­˜å‚¨ tweetId\n        LinkedList<Integer> tweet;\n\n        Node() {\n            followee = new HashSet<Integer>();\n            tweet = new LinkedList<Integer>();\n        }\n    }\n\n    // getNewsFeed æ£€ç´¢çš„æ¨æ–‡çš„ä¸Šé™ä»¥åŠ tweetId çš„æ—¶é—´æˆ³\n    private int recentMax, time;\n    // tweetId å¯¹åº”å‘é€çš„æ—¶é—´\n    private Map<Integer, Integer> tweetTime;\n    // æ¯ä¸ªç”¨æˆ·å­˜å‚¨çš„ä¿¡æ¯\n    private Map<Integer, Node> user;\n\n    public Twitter() {\n        time = 0;\n        recentMax = 10;\n        tweetTime = new HashMap<Integer, Integer>();\n        user = new HashMap<Integer, Node>();\n    }\n\n    // åˆå§‹åŒ–\n    public void init(int userId) {\n        user.put(userId, new Node());\n    }\n\n    public void postTweet(int userId, int tweetId) {\n        if (!user.containsKey(userId)) {\n            init(userId);\n        }\n        // è¾¾åˆ°é™åˆ¶ï¼Œå‰”é™¤é“¾è¡¨æœ«å°¾å…ƒç´ \n        if (user.get(userId).tweet.size() == recentMax) {\n            user.get(userId).tweet.remove(recentMax - 1);\n        }\n        user.get(userId).tweet.addFirst(tweetId);\n        tweetTime.put(tweetId, ++time);\n    }\n    \n    public List<Integer> getNewsFeed(int userId) {\n        LinkedList<Integer> ans = new LinkedList<Integer>();\n        for (int it : user.getOrDefault(userId, new Node()).tweet) {\n            ans.addLast(it);\n        }\n        for (int followeeId : user.getOrDefault(userId, new Node()).followee) {\n            if (followeeId == userId) { // å¯èƒ½å‡ºç°è‡ªå·±å…³æ³¨è‡ªå·±çš„æƒ…å†µ\n                continue;\n            }\n            LinkedList<Integer> res = new LinkedList<Integer>();\n            int tweetSize = user.get(followeeId).tweet.size();\n            Iterator<Integer> it = user.get(followeeId).tweet.iterator();\n            int i = 0;\n            int j = 0;\n            int curr = -1;\n            // çº¿æ€§å½’å¹¶\n            if (j < tweetSize) {\n                curr = it.next();\n                while (i < ans.size() && j < tweetSize) {\n                    if (tweetTime.get(curr) > tweetTime.get(ans.get(i))) {\n                        res.addLast(curr);\n                        ++j;\n                        if (it.hasNext()) {\n                            curr = it.next();\n                        }\n                    } else {\n                        res.addLast(ans.get(i));\n                        ++i;\n                    }\n                    // å·²ç»æ‰¾åˆ°è¿™ä¸¤ä¸ªé“¾è¡¨åˆèµ·æ¥åæœ€è¿‘çš„ recentMax æ¡æ¨æ–‡\n                    if (res.size() == recentMax) {\n                        break;\n                    }\n                }\n            }\n            for (; i < ans.size() && res.size() < recentMax; ++i) {\n                res.addLast(ans.get(i));\n            }\n            if (j < tweetSize && res.size() < recentMax) {\n                res.addLast(curr);\n                for (; it.hasNext() && res.size() < recentMax;) {\n                    res.addLast(it.next());\n                }\n            }\n            ans = new LinkedList<Integer>(res);\n        }\n        return ans;\n    }\n    \n    public void follow(int followerId, int followeeId) {\n        if (!user.containsKey(followerId)) {\n            init(followerId);\n        }\n        if (!user.containsKey(followeeId)) {\n            init(followeeId);\n        }\n        user.get(followerId).followee.add(followeeId);\n    }\n    \n    public void unfollow(int followerId, int followeeId) {\n        user.getOrDefault(followerId, new Node()).followee.remove(followeeId);\n    }\n}\n```\n\n```Python [sol1-Python3]\nclass Twitter:\n\n    class Node:\n        def __init__(self):\n            self.followee = set()\n            self.tweet = list()\n\n    def __init__(self):\n        self.time = 0\n        self.recentMax = 10\n        self.tweetTime = dict()\n        self.user = dict()\n\n    def postTweet(self, userId: int, tweetId: int) -> None:\n        if userId not in self.user:\n            self.user[userId] = Twitter.Node()\n        self.user[userId].tweet.append(tweetId)\n        self.time += 1\n        self.tweetTime[tweetId] = self.time\n\n    def getNewsFeed(self, userId: int) -> List[int]:\n        if userId not in self.user:\n            return list()\n        ans = self.user[userId].tweet[-10:][::-1]\n        for followeeId in self.user[userId].followee:\n            if followeeId in self.user:\n                opt = self.user[followeeId].tweet[-10:][::-1]\n                i, j, combined = 0, 0, list()\n                while i < len(ans) and j < len(opt):\n                    if self.tweetTime[ans[i]] > self.tweetTime[opt[j]]:\n                        combined.append(ans[i])\n                        i += 1\n                    else:\n                        combined.append(opt[j])\n                        j += 1\n                combined.extend(ans[i:])\n                combined.extend(opt[j:])\n                ans = combined[:10]\n        return ans\n\n    def follow(self, followerId: int, followeeId: int) -> None:\n        if followerId != followeeId:\n            if followerId not in self.user:\n                self.user[followerId] = Twitter.Node()\n            self.user[followerId].followee.add(followeeId)\n            \n    def unfollow(self, followerId: int, followeeId: int) -> None:\n        if followerId != followeeId:\n            if followerId in self.user:\n                self.user[followerId].followee.discard(followeeId)\n```\n\n**å¤æ‚åº¦åˆ†æ**\n\n- æ—¶é—´å¤æ‚åº¦ï¼š\n\t\n\t- æ“ä½œ `1` ï¼š $O(1)$ï¼Œé“¾è¡¨çš„æ’å…¥åˆ é™¤ä¸º $O(1)$ çš„å¤æ‚åº¦ã€‚\n\t\n\t- æ“ä½œ `2` ï¼š $O(\\textit{recentMax}*num)$ï¼Œå…¶ä¸­ `recentMax = 10`ï¼Œ `num` ä¸ºç”¨æˆ·å…³æ³¨çš„äººåŠ ä¸Šè‡ªå·±çš„æ•°é‡å’Œã€‚å› ä¸ºé“¾è¡¨é‡Œæœ€å¤šå­˜å‚¨ `recentMax` ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤æ¯æ¬¡åˆå¹¶ä¸¤ä¸ªé“¾è¡¨æœ€å¤šæ¯”è¾ƒ `recentMax` æ¬¡åèƒ½å¾—åˆ°ä¸¤ä¸ªé“¾è¡¨æœ€è¿‘çš„ `recentMax` ä¸ªæ¨æ–‡ï¼Œä¸€å…±éœ€è¦åˆå¹¶ `num` æ¬¡ï¼Œå› æ­¤æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(\\textit{recentMax}*num)$ã€‚\n\t\n\t- æ“ä½œ `3` ï¼š $O(1)$ï¼Œå“ˆå¸Œè¡¨æ’å…¥ä¸º $O(1)$ çš„å¤æ‚åº¦ã€‚\n\t\n\t- æ“ä½œ `4` ï¼š $O(1)$ï¼Œå“ˆå¸Œè¡¨æ’å…¥ä¸º $O(1)$ çš„å¤æ‚åº¦ã€‚\n\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(\\textit{recentMax}*tot)$ï¼Œå…¶ä¸­ `recentMax = 10`ï¼Œ`tot` ä¸ºæ¨ç‰¹æ€»ç”¨æˆ·æ•°ã€‚å³å¯¹äºæ¯ä¸ªç”¨æˆ·æˆ‘ä»¬ä¸ä¼šå­˜å‚¨è¶…è¿‡ `recentMax` ä¸ªæ¨ç‰¹ `Id`ï¼Œæ‰€ä»¥ç©ºé—´ä¸Šé™ä¸º $O(\\textit{recentMax}*tot)$ã€‚"
}