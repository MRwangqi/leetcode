{
	"titleSlug": "number-of-valid-move-combinations-on-chessboard",
	"slug": "bao-li-po-jie-de-si-lu-xiang-jie-fu-java-t437",
	"url": "https://leetcode-cn.com/problems/number-of-valid-move-combinations-on-chessboard/solution/bao-li-po-jie-de-si-lu-xiang-jie-fu-java-t437/",
	"content": "è¿™é¢˜çœŸçš„å¾ˆéº»çƒ¦ï¼Œå°±æ˜¯ç¡¬åšã€‚\næ‰¾åˆ°æ‰€æœ‰çš„å¯èƒ½çš„ç§»åŠ¨ç»„åˆï¼Œç„¶åæ£€æŸ¥æ˜¯ä¸æ˜¯æœ‰æ•ˆçš„ç»„åˆã€‚\n\n### å®¡é¢˜\n**ä¸‰ç§æ£‹å­çš„é„™è§†é“¾ï¼š**\n- åï¼šæ— æ•Œï¼Œ8ä¸ªæ–¹å‘ç§»åŠ¨\n- è½¦ï¼šæ°´å¹³ç§»åŠ¨ï¼Œåªæœ‰4ä¸ªè¡ŒåŠ¨æ–¹å‘\n- è±¡ï¼šå¯¹è§’çº¿ç§»åŠ¨ï¼Œ4ä¸ªè¡ŒåŠ¨æ–¹å‘\n\n**æ•´ä½“ç­–ç•¥ï¼š**\næˆ‘ä»¬éœ€è¦è®°å½•ä¸‹æ¯ä¸ªç»„åˆä¸­æ¯ä¸ªæ£‹å­çš„ä¸­è½¬ä½ç½®å’Œæœ€ç»ˆä½ç½®ã€‚\nå‡è®¾ä¸€å…±æœ‰nä¸ªæ£‹å­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªn\\*8\\*8çš„ä¸‰ç»´æ•°ç»„æ¥å­˜å‚¨æ¯ä¸€ä¸ªæ£‹å­çš„æƒ…å†µã€‚\næŒ‰ç…§æ£‹å­çš„é¡ºåºï¼Œä»å·¦è‡³å³ï¼Œæˆ‘ä»¬ä¾æ¬¡éå†æ£‹å­çš„ç§»åŠ¨æƒ…å†µã€‚\nå½“ç¬¬ä¸€ä¸ªæ£‹å­åœ¨å®Œæˆç§»åŠ¨ä¹‹åï¼Œæˆ‘ä»¬é€’å½’è°ƒç”¨éå†æ–¹æ³•ï¼Œè€ƒè™‘ç¬¬äºŒä¸ªæ£‹å­çš„ç§»åŠ¨ï¼Œç›´åˆ°è€ƒè™‘å®Œæ‰€æœ‰æ£‹å­çš„æƒ…å†µã€‚\n\nğŸŒ°ä¸¾ä¸ªä¾‹å­ï¼š\nå‡è®¾ä¸€å…±æœ‰2ä¸ªæ£‹å­ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ª2\\*8\\*8çš„ä¸‰ç»´æ•°ç»„æ¥å­˜å‚¨æ¯ä¸€ä¸ªæ£‹å­çš„æƒ…å†µã€‚\næŒ‰ç…§æ£‹å­çš„é¡ºåºï¼Œä»å·¦è‡³å³ï¼Œæˆ‘ä»¬ä¾æ¬¡éå†æ£‹å­çš„ç§»åŠ¨æƒ…å†µã€‚\nå½“ç¬¬ä¸€ä¸ªæ£‹å­åœ¨å®Œæˆç§»åŠ¨ä¹‹åï¼Œæˆ‘ä»¬è€ƒè™‘ç¬¬äºŒä¸ªæ£‹å­çš„ç§»åŠ¨ã€‚\nåœ¨è€ƒè™‘ç¬¬äºŒä¸ªæ£‹å­çš„ç§»åŠ¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç»“åˆç¬¬ä¸€ä¸ªæ£‹å­çš„æƒ…å†µè¿›è¡Œåˆ¤æ–­ã€‚å…·ä½“æ–¹æ³•å¦‚ä¸‹ã€‚\n\n**å•ä¸ªæ£‹å­ç§»åŠ¨ç­–ç•¥ï¼š**\næ¯ä¸ªæ£‹å­å‡†å¤‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä½ç½®æ—¶ï¼Œ\né¦–å…ˆï¼Œéœ€è¦è€ƒè™‘ä¸‹ä¸€ä½ç½®æ˜¯å¦åœ¨æ£‹ç›˜å†…ï¼Œ\nå…¶æ¬¡ï¼Œç§»åŠ¨åï¼Œå®ƒæœ‰ä¸¤ä¸ªé€‰æ‹©ï¼š\n1. åœåœ¨å½“å‰ä½ç½®ï¼Œä¸å†ç§»åŠ¨\nåªæœ‰å½“ä»¥ä¸‹æ¡ä»¶ï¼Œå¯¹äºæ‰€æœ‰ä¹‹å‰æ£‹å­éƒ½æ»¡è¶³æ—¶ï¼Œæ£‹å­æ‰å¯ä»¥åœ¨è¿™ä¸ªä½ç½®ä¸Šåœç•™ï¼š\nâ€¢  æ²¡æœ‰å…¶ä»–æ£‹å­åœ¨è¿™æ¬¡ç§»åŠ¨ç»„åˆä¸­åœç•™åœ¨è¿™ä¸ªä½ç½®ä¸Š\nâ€¢  æ²¡æœ‰å…¶ä»–æ£‹å­éœ€è¦åœ¨è¿™ä¸€æ—¶é—´åç»è¿‡è¿™ä¸ªä½ç½®\n2. ç»§ç»­ç§»åŠ¨\nè‹¥é€‰æ‹©ç»§ç»­ç§»åŠ¨ï¼Œåˆ™éœ€è¦è€ƒè™‘ä¸‹ä¸€æ¬¡ç§»åŠ¨çš„ä½ç½®çš„ä»¥ä¸‹å‡ ç‚¹ï¼š\nâ€¢  æ˜¯å¦æœ‰å…¶ä»–æ£‹å­åŒæ—¶ç»è¿‡\nâ€¢  æ˜¯å¦æœ‰å…¶ä»–æ£‹å­æ—©äºæˆ–ç­‰äºå½“å‰æ—¶é—´åœç•™åœ¨è¿™ä¸ªä½ç½®ä¸Š\nå¦‚æœæœ‰ä»¥ä¸Šä¸€ç‚¹å‘ç”Ÿï¼Œé‚£ä¹ˆå½“å‰è¿™ä¸ªç»„åˆå°±ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç»„åˆ\n\n**ç‰¹åˆ«åœ°ï¼Œ**\nä»ä¸Šé¢çš„æè¿°å¯ä»¥çœ‹å‡ºï¼Œä¸­è½¬ä½ç½®å’Œæœ€ç»ˆä½ç½®ï¼Œå¯¹äºåç»­æ£‹å­ç§»åŠ¨çš„å½±å“æ˜¯ä¸ä¸€æ ·çš„ã€‚æœ€ç»ˆä½ç½®ä¼šé˜»ç¢ä¸‹ä¸€æ£‹å­å¯¹äºè¿™ä¸€æ–¹å‘çš„åç»­æ‰€æœ‰è¡ŒåŠ¨ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ£‹ç›˜ä¸ŠåŒºåˆ«ä¸­è½¬ä½ç½®å’Œæœ€ç»ˆä½ç½®ã€‚è¿™é‡Œç”¨åˆ°çš„ä¸€ä¸ªæŠ€å·§å°±æ˜¯ï¼Œå¯¹äºæœ€ç»ˆä½ç½®ï¼Œæˆ‘ä»¬ç”¨è´Ÿæ•°è¡¨ç¤ºï¼Œè€Œä¸­è½¬ä½ç½®èƒ½ç”¨æ—¶é—´tæ­£æ•°è¡¨ç¤ºã€‚\n\nè¯ä¸å¤šè¯´ï¼Œæ¥ä¸Šä»£ç å§\n\n```java_è¯¦ç»†æ³¨é‡Š []\nclass Solution {\n    // æ‰€æœ‰å¯èƒ½çš„ç§»åŠ¨æ–¹å‘ï¼Œâ€œåâ€å¯ä»¥å‘å…¨éƒ¨æ–¹å‘ï¼Œâ€œè½¦â€å¯ä»¥ç§»åŠ¨å‰å››ä¸ªæ–¹å‘ï¼Œâ€œè±¡â€å¯ä»¥ç§»åŠ¨åå››ä¸ªæ–¹å‘\n    int[][] dirs = new int[][] {{0, 1}, {1, 0}, {0, -1}, {-1, 0}, {1, 1}, {1, -1}, {-1, -1}, {-1, 1}};\n    int[][][] board;\n\n    public int countCombinations(String[] pieces, int[][] positions) {\n        board = new int[positions.length][8][8];\n        return count_recursive(pieces, positions, 0); // ä»ç¬¬ä¸€ä¸ªæ£‹å­çš„åˆå§‹ä½ç½®å¼€å§‹è€ƒè™‘\n    }\n\n    // è€ƒè™‘ç¬¬iä¸ªæ£‹å­ï¼Œåœ¨å‰i-1ä¸ªæ£‹å­ä½ç½®å·²ç»ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç§»åŠ¨çš„ç»„åˆæ•°é‡\n    public int count_recursive(String[] pieces, int[][] positions, int i) {\n        if (i >= pieces.length)\n           return 1; // å¦‚æœåé¢æ²¡æœ‰å…¶å®ƒæ£‹å­äº†ï¼Œé‚£ä¹ˆå½“å‰ç»„åˆçš„æ•°é‡åªæœ‰1\n\n        int x = positions[i][0] - 1, y = positions[i][1] - 1, res = 0; // èµ·å§‹ä½ç½®å¼€å§‹è€ƒè™‘\n        for (int d = 0; d < 8; d++){ // éå†å„ä¸ªæ–¹å‘\n            if ((d < 4 && pieces[i].equals(\"bishop\")) || (d >= 4 && pieces[i].equals(\"rook\")))\n               continue;\n\n            boolean blocked = false;           \n            for (int step = res == 0 ? 1 : 2; !blocked; step++) { // å› ä¸ºèµ·å§‹ä½ç½®åœ¨8ä¸ªæ–¹å‘ä¸­åªèƒ½è€ƒè™‘ä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨resä½œä¸ºæ——å¸œï¼Œåªæœ‰ç¬¬ä¸€æ¬¡ç§»åŠ¨æ—¶ä¼šè€ƒè™‘åœç•™åœ¨åˆå§‹ä½ç½®\n                int nx = x + (step-1) * dirs[d][0]; // æ–°åæ ‡\n                int ny = y + (step-1) * dirs[d][1];\n\n                if (nx < 0 || nx >= 8 || ny < 0 || ny >= 8) // æ£‹ç›˜å¤–äº†ï¼Œæ— æ•ˆç§»åŠ¨ï¼Œæ”¾å¼ƒè¿™ä¸ªæ–¹å‘\n                    break;\n\n                boolean canStop = true;\n                for (int j = 0; j < i; j++) { // æ£€æŸ¥å‰i-1ä¸ªæ£‹å­çš„åœ¨å½“å‰ä½ç½®çš„æƒ…å†µï¼Œåˆ¤æ–­æˆ‘ä»¬æ˜¯å¦å¯ä»¥é€‰æ‹©åœç•™æˆ–ç»§ç»­å‰è¿›\n                    // åªæœ‰å½“å‰i-1ä¸ªæ£‹å­éƒ½æ²¡æœ‰åœç•™ï¼Œå¹¶ä¸”æ²¡æœ‰æ£‹å­ä¼šåœ¨ä¹‹åç»è¿‡ï¼Œç¬¬iä¸ªæ£‹å­æ‰å¯ä»¥åœ¨å½“å‰ä½ç½®åœç•™\n                    canStop = canStop && (board[j][nx][ny] >= 0) && (board[j][nx][ny] < step);\n                    // å¦‚æœå‰i-1ä¸ªæ£‹å­åœ¨å½“å‰æ—¶é—´ä¹‹å‰åœç•™åœ¨æ­¤ä½ç½®ï¼Œæˆ–è€…æœ‰æ£‹å­åŒæ—¶ç»è¿‡è¿™é‡Œï¼Œç¬¬iä¸ªæ£‹å­å°±ä¸å¯ä»¥ç»§ç»­å‰è¿›äº†\n                    blocked = blocked || ((board[j][nx][ny] < 0) && (-board[j][nx][ny] <= step)) || (board[j][nx][ny] == step);\n                }\n\n                if (!canStop)  { // å¦‚æœå¯ä»¥åœç•™\n                    board[i][nx][ny] = -step; // ç”¨è´Ÿæ•°æ ‡è®°å½“å‰ä½ç½®ä¸ºæ£‹å­içš„åœç•™ä½\n                    res += count_recursive(pieces, positions, i+1); // è€ƒè™‘ä¸‹ä¸€ä¸ªæ£‹å­çš„ç§»åŠ¨çš„å¯èƒ½æ€§\n                }\n                board[i][nx][ny] = step; // é€‰æ‹©ç»§ç»­ç§»åŠ¨\n            }\n            board[i] = new int[8][8]; // å½“å‰æ–¹å‘è€ƒè™‘ç»“æŸï¼Œæ¸…ç©ºæ£‹ç›˜ï¼Œè€ƒè™‘ä¸‹ä¸€ä¸ªæ–¹å‘\n        }\n        return res; // è¿”å›å¯èƒ½çš„æ€»æ•°\n    }\n}\n```\n```java_çº¯äº«ç‰ˆ []\nclass Solution {\n    int[][] dirs = new int[][] {{0, 1}, {1, 0}, {0, -1}, {-1, 0}, {1, 1}, {1, -1}, {-1, -1}, {-1, 1}};\n    int[][][] board;\n\n    public int countCombinations(String[] pieces, int[][] positions) {\n        board = new int[positions.length][8][8];\n        return count_recursive(pieces, positions, 0);\n    }\n\n    public int count_recursive(String[] pieces, int[][] positions, int i) {\n        if (i >= pieces.length)\n           return 1;\n        int x = positions[i][0] - 1, y = positions[i][1] - 1, res = 0;\n\n        for (int d = 0; d < 8; d++){\n            if ((d < 4 && pieces[i].equals(\"bishop\")) || (d >= 4 && pieces[i].equals(\"rook\")))\n               continue;\n\n            boolean blocked = false;           \n            for (int step = res == 0 ? 1 : 2; !blocked; step++) { // ?\n                int nx = x + (step-1) * dirs[d][0];\n                int ny = y + (step-1) * dirs[d][1];\n\n                if (nx < 0 || nx >= 8 || ny < 0 || ny >= 8) //if goes out of board\n                    break;\n\n                boolean canStop = true;\n                for (int j = 0; j < i; j++) {\n                    canStop = canStop && (board[j][nx][ny] >= 0) && (board[j][nx][ny] < step);\n                    blocked = blocked || ((board[j][nx][ny] < 0) && (-board[j][nx][ny] <= step)) || (board[j][nx][ny] == step);\n                }\n\n                if (canStop)  {\n                    board[i][nx][ny] = -step;\n                    res += count_recursive(pieces, positions, i+1);\n                }\n                board[i][nx][ny] = step;\n            }\n            board[i] = new int[8][8];\n        }\n        return res;\n    }\n}\n```\n\n\n\n"
}