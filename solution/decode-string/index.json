{
	"titleSlug": "decode-string",
	"slug": "zi-fu-chuan-jie-ma-by-leetcode-solution",
	"url": "https://leetcode-cn.com/problems/decode-string/solution/zi-fu-chuan-jie-ma-by-leetcode-solution/",
	"content": "### ğŸ“º è§†é¢‘é¢˜è§£  \n![394. å­—ç¬¦ä¸²è§£ç .mp4](2a9aeb51-59d9-4cc3-9d02-4ac416c29cef)\n\n### ğŸ“– æ–‡å­—é¢˜è§£\n#### æ–¹æ³•ä¸€ï¼šæ ˆæ“ä½œ\n\n**æ€è·¯å’Œç®—æ³•**\n\næœ¬é¢˜ä¸­å¯èƒ½å‡ºç°æ‹¬å·åµŒå¥—çš„æƒ…å†µï¼Œæ¯”å¦‚ `2[a2[bc]]`ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥å…ˆè½¬åŒ–æˆ `2[abcbc]`ï¼Œåœ¨è½¬åŒ–æˆ `abcbcabcbc`ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå­—æ¯ã€æ•°å­—å’Œæ‹¬å·çœ‹æˆæ˜¯ç‹¬ç«‹çš„ TOKENï¼Œå¹¶ç”¨æ ˆæ¥ç»´æŠ¤è¿™äº› TOKENã€‚å…·ä½“çš„åšæ³•æ˜¯ï¼Œéå†è¿™ä¸ªæ ˆï¼š\n\n+ å¦‚æœå½“å‰çš„å­—ç¬¦ä¸ºæ•°ä½ï¼Œè§£æå‡ºä¸€ä¸ªæ•°å­—ï¼ˆè¿ç»­çš„å¤šä¸ªæ•°ä½ï¼‰å¹¶è¿›æ ˆ\n+ å¦‚æœå½“å‰çš„å­—ç¬¦ä¸ºå­—æ¯æˆ–è€…å·¦æ‹¬å·ï¼Œç›´æ¥è¿›æ ˆ\n+ å¦‚æœå½“å‰çš„å­—ç¬¦ä¸ºå³æ‹¬å·ï¼Œå¼€å§‹å‡ºæ ˆï¼Œä¸€ç›´åˆ°å·¦æ‹¬å·å‡ºæ ˆï¼Œå‡ºæ ˆåºåˆ—åè½¬åæ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶å–å‡ºæ ˆé¡¶çš„æ•°å­—ï¼ˆ**æ­¤æ—¶æ ˆé¡¶ä¸€å®šæ˜¯æ•°å­—ï¼Œæƒ³æƒ³ä¸ºä»€ä¹ˆï¼Ÿ**ï¼‰ï¼Œå°±æ˜¯è¿™ä¸ªå­—ç¬¦ä¸²åº”è¯¥å‡ºç°çš„æ¬¡æ•°ï¼Œæˆ‘ä»¬æ ¹æ®è¿™ä¸ªæ¬¡æ•°å’Œå­—ç¬¦ä¸²æ„é€ å‡ºæ–°çš„å­—ç¬¦ä¸²å¹¶è¿›æ ˆ\n\né‡å¤å¦‚ä¸Šæ“ä½œï¼Œæœ€ç»ˆå°†æ ˆä¸­çš„å…ƒç´ æŒ‰ç…§ä»æ ˆåº•åˆ°æ ˆé¡¶çš„é¡ºåºæ‹¼æ¥èµ·æ¥ï¼Œå°±å¾—åˆ°äº†ç­”æ¡ˆã€‚**æ³¨æ„ï¼šè¿™é‡Œå¯ä»¥ç”¨ä¸å®šé•¿æ•°ç»„æ¥æ¨¡æ‹Ÿæ ˆæ“ä½œï¼Œæ–¹ä¾¿ä»æ ˆåº•å‘æ ˆé¡¶éå†ã€‚**\n\n```cpp [sol1-C++]\nclass Solution {\npublic:\n    string getDigits(string &s, size_t &ptr) {\n        string ret = \"\";\n        while (isdigit(s[ptr])) {\n            ret.push_back(s[ptr++]);\n        }\n        return ret;\n    }\n\n    string getString(vector <string> &v) {\n        string ret;\n        for (const auto &s: v) {\n            ret += s;\n        }\n        return ret;\n    }\n\n    string decodeString(string s) {\n        vector <string> stk;\n        size_t ptr = 0;\n\n        while (ptr < s.size()) {\n            char cur = s[ptr];\n            if (isdigit(cur)) {\n                // è·å–ä¸€ä¸ªæ•°å­—å¹¶è¿›æ ˆ\n                string digits = getDigits(s, ptr);\n                stk.push_back(digits);\n            } else if (isalpha(cur) || cur == '[') {\n                // è·å–ä¸€ä¸ªå­—æ¯å¹¶è¿›æ ˆ\n                stk.push_back(string(1, s[ptr++])); \n            } else {\n                ++ptr;\n                vector <string> sub;\n                while (stk.back() != \"[\") {\n                    sub.push_back(stk.back());\n                    stk.pop_back();\n                }\n                reverse(sub.begin(), sub.end());\n                // å·¦æ‹¬å·å‡ºæ ˆ\n                stk.pop_back();\n                // æ­¤æ—¶æ ˆé¡¶ä¸ºå½“å‰ sub å¯¹åº”çš„å­—ç¬¦ä¸²åº”è¯¥å‡ºç°çš„æ¬¡æ•°\n                int repTime = stoi(stk.back()); \n                stk.pop_back();\n                string t, o = getString(sub);\n                // æ„é€ å­—ç¬¦ä¸²\n                while (repTime--) t += o; \n                // å°†æ„é€ å¥½çš„å­—ç¬¦ä¸²å…¥æ ˆ\n                stk.push_back(t);\n            }\n        }\n\n        return getString(stk);\n    }\n};\n```\n\n```Java [sol1-Java]\nclass Solution {\n    int ptr;\n\n    public String decodeString(String s) {\n        LinkedList<String> stk = new LinkedList<String>();\n        ptr = 0;\n\n        while (ptr < s.length()) {\n            char cur = s.charAt(ptr);\n            if (Character.isDigit(cur)) {\n                // è·å–ä¸€ä¸ªæ•°å­—å¹¶è¿›æ ˆ\n                String digits = getDigits(s);\n                stk.addLast(digits);\n            } else if (Character.isLetter(cur) || cur == '[') {\n                // è·å–ä¸€ä¸ªå­—æ¯å¹¶è¿›æ ˆ\n                stk.addLast(String.valueOf(s.charAt(ptr++))); \n            } else {\n                ++ptr;\n                LinkedList<String> sub = new LinkedList<String>();\n                while (!\"[\".equals(stk.peekLast())) {\n                    sub.addLast(stk.removeLast());\n                }\n                Collections.reverse(sub);\n                // å·¦æ‹¬å·å‡ºæ ˆ\n                stk.removeLast();\n                // æ­¤æ—¶æ ˆé¡¶ä¸ºå½“å‰ sub å¯¹åº”çš„å­—ç¬¦ä¸²åº”è¯¥å‡ºç°çš„æ¬¡æ•°\n                int repTime = Integer.parseInt(stk.removeLast());\n                StringBuffer t = new StringBuffer();\n                String o = getString(sub);\n                // æ„é€ å­—ç¬¦ä¸²\n                while (repTime-- > 0) {\n                    t.append(o);\n                }\n                // å°†æ„é€ å¥½çš„å­—ç¬¦ä¸²å…¥æ ˆ\n                stk.addLast(t.toString());\n            }\n        }\n\n        return getString(stk);\n    }\n\n    public String getDigits(String s) {\n        StringBuffer ret = new StringBuffer();\n        while (Character.isDigit(s.charAt(ptr))) {\n            ret.append(s.charAt(ptr++));\n        }\n        return ret.toString();\n    }\n\n    public String getString(LinkedList<String> v) {\n        StringBuffer ret = new StringBuffer();\n        for (String s : v) {\n            ret.append(s);\n        }\n        return ret.toString();\n    }\n}\n```\n\n```golang [sol1-Golang]\nfunc decodeString(s string) string {\n    stk := []string{}\n    ptr := 0\n    for ptr < len(s) {\n        cur := s[ptr]\n        if cur >= '0' && cur <= '9' {\n            digits := getDigits(s, &ptr)\n            stk = append(stk, digits)\n        } else if (cur >= 'a' && cur <= 'z' || cur >= 'A' && cur <= 'Z') || cur == '[' {\n            stk = append(stk, string(cur))\n            ptr++\n        } else {\n            ptr++\n            sub := []string{}\n            for stk[len(stk)-1] != \"[\" {\n                sub = append(sub, stk[len(stk)-1])\n                stk = stk[:len(stk)-1]\n            }\n            for i := 0; i < len(sub)/2; i++ {\n                sub[i], sub[len(sub)-i-1] = sub[len(sub)-i-1], sub[i]\n            }\n            stk = stk[:len(stk)-1]\n            repTime, _ := strconv.Atoi(stk[len(stk)-1])\n            stk = stk[:len(stk)-1]\n            t := strings.Repeat(getString(sub), repTime)\n            stk = append(stk, t)\n        }\n    }\n    return getString(stk)\n}\n\nfunc getDigits(s string, ptr *int) string {\n    ret := \"\"\n    for ; s[*ptr] >= '0' && s[*ptr] <= '9'; *ptr++ {\n        ret += string(s[*ptr])\n    }\n    return ret\n}\n\nfunc getString(v []string) string {\n    ret := \"\"\n    for _, s := range v {\n        ret += s\n    }\n    return ret\n}\n```\n\n**å¤æ‚åº¦åˆ†æ**\n\n+ æ—¶é—´å¤æ‚åº¦ï¼šè®°è§£ç åå¾—å‡ºçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º $S$ï¼Œé™¤äº†éå†ä¸€æ¬¡åŸå­—ç¬¦ä¸² $s$ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†è§£ç åçš„å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½å…¥æ ˆï¼Œå¹¶æœ€ç»ˆæ‹¼æ¥è¿›ç­”æ¡ˆä¸­ï¼Œæ•…æ¸è¿›æ—¶é—´å¤æ‚åº¦ä¸º $O(S+|s|)$ï¼Œå³ $O(S)$ã€‚\n+ ç©ºé—´å¤æ‚åº¦ï¼šè®°è§£ç åå¾—å‡ºçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º $S$ï¼Œè¿™é‡Œç”¨æ ˆç»´æŠ¤ TOKENï¼Œæ ˆçš„æ€»å¤§å°æœ€ç»ˆä¸ $S$ ç›¸åŒï¼Œæ•…æ¸è¿›ç©ºé—´å¤æ‚åº¦ä¸º $O(S)$ã€‚\n\n#### æ–¹æ³•äºŒï¼šé€’å½’\n\n**æ€è·¯å’Œç®—æ³•**\n\næˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨é€’å½’æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»å·¦å‘å³è§£æå­—ç¬¦ä¸²ï¼š\n\n+ å¦‚æœå½“å‰ä½ç½®ä¸ºæ•°å­—ä½ï¼Œé‚£ä¹ˆåé¢ä¸€å®šåŒ…å«ä¸€ä¸ªç”¨æ–¹æ‹¬å·è¡¨ç¤ºçš„å­—ç¬¦ä¸²ï¼Œå³å±äºè¿™ç§æƒ…å†µï¼š`k[...]`ï¼š\n  + æˆ‘ä»¬å¯ä»¥å…ˆè§£æå‡ºä¸€ä¸ªæ•°å­—ï¼Œç„¶åè§£æåˆ°äº†å·¦æ‹¬å·ï¼Œé€’å½’å‘ä¸‹è§£æåé¢çš„å†…å®¹ï¼Œé‡åˆ°å¯¹åº”çš„å³æ‹¬å·å°±è¿”å›ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥æ ¹æ®è§£æå‡ºçš„æ•°å­— $x$ è§£æå‡ºçš„æ‹¬å·é‡Œçš„å­—ç¬¦ä¸² $s'$ æ„é€ å‡ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸² $x \\times s'$ï¼›\n  + æˆ‘ä»¬æŠŠ `k[...]` è§£æç»“æŸåï¼Œå†æ¬¡è°ƒç”¨é€’å½’å‡½æ•°ï¼Œè§£æå³æ‹¬å·å³è¾¹çš„å†…å®¹ã€‚\n+ å¦‚æœå½“å‰ä½ç½®æ˜¯å­—æ¯ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥è§£æå½“å‰è¿™ä¸ªå­—æ¯ï¼Œç„¶åé€’å½’å‘ä¸‹è§£æè¿™ä¸ªå­—æ¯åé¢çš„å†…å®¹ã€‚\n\n**å¦‚æœè§‰å¾—è¿™é‡Œè®²çš„æ¯”è¾ƒæŠ½è±¡ï¼Œå¯ä»¥ç»“åˆä»£ç ç†è§£ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚**\n\n**ä¸‹é¢æˆ‘ä»¬å¯ä»¥æ¥è®²è®²è¿™æ ·åšçš„ä¾æ®ï¼Œæ¶‰åŠåˆ°ã€Šç¼–è¯‘åŸç†ã€‹ç›¸å…³å†…å®¹ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒé˜…è¯»ã€‚** æ ¹æ®é¢˜ç›®çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºè¿™æ ·çš„å·´ç§‘æ–¯èŒƒå¼ï¼ˆBNFï¼‰ï¼š\n$$\n\\begin{aligned} \n    {\\rm String} &\\rightarrow {\n        \\rm Digits \\, [String] \\, String \\, | \\,\n        Alpha \\, String \\, | \\, \n        \\epsilon \n    } \\\\\n    {\\rm Digits} &\\rightarrow {\n        \\rm Digit \\, Digits \\, | \\,\n        Digit \n    } \\\\\n    {\\rm Alpha} &\\rightarrow { \n        a | \\cdots | z | A | \\cdots | Z\n    } \\\\\n    {\\rm Digit} &\\rightarrow { \n        0 | \\cdots | 9\n    } \\\\\n    \\end{aligned}\n$$\n\n+ $\\rm Digit$ è¡¨ç¤ºåè¿›åˆ¶æ•°ä½ï¼Œå¯èƒ½çš„å–å€¼æ˜¯ $0$ åˆ° $9$ ä¹‹é—´çš„æ•´æ•°\n+ $\\rm Alpha$ è¡¨ç¤ºå­—æ¯ï¼Œå¯èƒ½çš„å–å€¼æ˜¯å¤§å°å†™å­—æ¯çš„é›†åˆï¼Œå…± $52$ ä¸ª\n+ $\\rm Digit$ è¡¨ç¤ºä¸€ä¸ªæ•´æ•°ï¼Œå®ƒçš„ç»„æˆæ˜¯ $\\rm Digit$ å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡\n+ $\\rm String$ ä»£è¡¨ä¸€ä¸ªä»£è§£æçš„å­—ç¬¦ä¸²ï¼Œå®ƒå¯èƒ½æœ‰ä¸‰ç§æ„æˆï¼Œå¦‚ BNF æ‰€ç¤º\n+ $\\rm \\epsilon$ è¡¨ç¤ºç©ºä¸²ï¼Œå³æ²¡æœ‰ä»»ä½•å­å­—ç¬¦\n\nç”±äº $\\rm Digits$ å’Œ $\\rm Alpha$ æ„æˆç®€å•ï¼Œå¾ˆå®¹æ˜“è¿›è¡Œè¯æ³•åˆ†æï¼Œæˆ‘ä»¬æŠŠå®ƒä»–ä»¬çœ‹ä½œç‹¬ç«‹çš„ TOKENã€‚é‚£ä¹ˆæ­¤æ—¶çš„éç»ˆç»“ç¬¦æœ‰ $\\rm String$ï¼Œç»ˆç»“ç¬¦æœ‰ $\\rm Digits$ã€$\\rm Alpha$ å’Œ $\\rm  \\epsilon$ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éç»ˆç»“ç¬¦å’Œ FOLLOW é›†æ„é€ å‡ºè¿™æ ·çš„é¢„æµ‹åˆ†æè¡¨ï¼š\n| |$\\rm Alpha$|$\\rm Digits$|$\\rm \\epsilon$|\n|----|----|----|----|\n|$\\rm String$| $\\rm String \\rightarrow Alpha \\, String$ | $\\rm String \\rightarrow Digits \\, [String] \\, String$ | $\\rm String \\rightarrow \\epsilon$ |\n\nå¯è§ä¸å«å¤šé‡å®šä¹‰çš„é¡¹ï¼Œä¸º LL(1) æ–‡æ³•ï¼Œå³ï¼š\n\n- ä»å·¦å‘å³åˆ†æï¼ˆLeft-to-right-parseï¼‰\n- æœ€å·¦æ¨å¯¼ï¼ˆLeftmost-derivationï¼‰\n- è¶…å‰æŸ¥çœ‹ä¸€ä¸ªç¬¦å·ï¼ˆ1-symbol lookaheadï¼‰\n\nå®ƒå†³å®šäº†æˆ‘ä»¬ä»å·¦å‘å³éå†è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯æ¬¡åªåˆ¤æ–­å½“å‰æœ€å·¦è¾¹çš„ä¸€ä¸ªå­—ç¬¦çš„åˆ†ææ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚\n\nä»£ç å¦‚ä¸‹ã€‚\n\n```cpp [sol2-C++]\nclass Solution {\npublic:\n    string src; \n    size_t ptr;\n\n    int getDigits() {\n        int ret = 0;\n        while (ptr < src.size() && isdigit(src[ptr])) {\n            ret = ret * 10 + src[ptr++] - '0';\n        }\n        return ret;\n    }\n\n    string getString() {\n        if (ptr == src.size() || src[ptr] == ']') {\n            // String -> EPS\n            return \"\";\n        }\n\n        char cur = src[ptr]; int repTime = 1;\n        string ret;\n\n        if (isdigit(cur)) {\n            // String -> Digits [ String ] String\n            // è§£æ Digits\n            repTime = getDigits(); \n            // è¿‡æ»¤å·¦æ‹¬å·\n            ++ptr;\n            // è§£æ String\n            string str = getString(); \n            // è¿‡æ»¤å³æ‹¬å·\n            ++ptr;\n            // æ„é€ å­—ç¬¦ä¸²\n            while (repTime--) ret += str; \n        } else if (isalpha(cur)) {\n            // String -> Char String\n            // è§£æ Char\n            ret = string(1, src[ptr++]);\n        }\n        \n        return ret + getString();\n    }\n\n    string decodeString(string s) {\n        src = s;\n        ptr = 0;\n        return getString();\n    }\n};\n```\n\n```Java [sol2-Java]\nclass Solution {\n    String src;\n    int ptr;\n\n    public String decodeString(String s) {\n        src = s;\n        ptr = 0;\n        return getString();\n    }\n\n    public String getString() {\n        if (ptr == src.length() || src.charAt(ptr) == ']') {\n            // String -> EPS\n            return \"\";\n        }\n\n        char cur = src.charAt(ptr);\n        int repTime = 1;\n        String ret = \"\";\n\n        if (Character.isDigit(cur)) {\n            // String -> Digits [ String ] String\n            // è§£æ Digits\n            repTime = getDigits(); \n            // è¿‡æ»¤å·¦æ‹¬å·\n            ++ptr;\n            // è§£æ String\n            String str = getString(); \n            // è¿‡æ»¤å³æ‹¬å·\n            ++ptr;\n            // æ„é€ å­—ç¬¦ä¸²\n            while (repTime-- > 0) {\n                ret += str;\n            }\n        } else if (Character.isLetter(cur)) {\n            // String -> Char String\n            // è§£æ Char\n            ret = String.valueOf(src.charAt(ptr++));\n        }\n        \n        return ret + getString();\n    }\n\n    public int getDigits() {\n        int ret = 0;\n        while (ptr < src.length() && Character.isDigit(src.charAt(ptr))) {\n            ret = ret * 10 + src.charAt(ptr++) - '0';\n        }\n        return ret;\n    }\n}\n```\n\n```golang [sol2-Golang]\nvar (\n    src string\n    ptr int\n)\n\nfunc decodeString(s string) string {\n    src = s\n    ptr = 0\n    return getString()\n}\n\nfunc getString() string {\n    if ptr == len(src) || src[ptr] == ']' {\n        return \"\"\n    }\n    cur := src[ptr]\n    repTime := 1\n    ret := \"\"\n    if cur >= '0' && cur <= '9' {\n        repTime = getDigits()\n        ptr++\n        str := getString()\n        ptr++\n        ret = strings.Repeat(str, repTime)\n    } else if cur >= 'a' && cur <= 'z' || cur >= 'A' && cur <= 'Z' {\n        ret = string(cur)\n        ptr++\n    }\n    return ret + getString()\n}\n\nfunc getDigits() int {\n    ret := 0\n    for ; src[ptr] >= '0' && src[ptr] <= '9'; ptr++ {\n        ret = ret * 10 + int(src[ptr] - '0')\n    }\n    return ret\n}\n```\n\n**å¤æ‚åº¦åˆ†æ**\n\n+ æ—¶é—´å¤æ‚åº¦ï¼šè®°è§£ç åå¾—å‡ºçš„å­—ç¬¦ä¸²é•¿åº¦ä¸º $S$ï¼Œé™¤äº†éå†ä¸€æ¬¡åŸå­—ç¬¦ä¸² $s$ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†è§£ç åçš„å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦éƒ½æ‹¼æ¥è¿›ç­”æ¡ˆä¸­ï¼Œæ•…æ¸è¿›æ—¶é—´å¤æ‚åº¦ä¸º $O(S+|s|)$ï¼Œå³ $O(S)$ã€‚\n+ ç©ºé—´å¤æ‚åº¦ï¼šè‹¥ä¸è€ƒè™‘ç­”æ¡ˆæ‰€å ç”¨çš„ç©ºé—´ï¼Œé‚£ä¹ˆå°±åªå‰©é€’å½’ä½¿ç”¨æ ˆç©ºé—´çš„å¤§å°ï¼Œè¿™é‡Œæ ˆç©ºé—´çš„ä½¿ç”¨å’Œé€’å½’æ ‘çš„æ·±åº¦æˆæ­£æ¯”ï¼Œæœ€åæƒ…å†µä¸‹ä¸º $O(|s|)$ï¼Œæ•…æ¸è¿›ç©ºé—´å¤æ‚åº¦ä¸º $O(|s|)$ã€‚"
}