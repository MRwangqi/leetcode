{
	"titleSlug": "max-sum-of-rectangle-no-larger-than-k",
	"slug": "ju-xing-qu-yu-bu-chao-guo-k-de-zui-da-sh-70q2",
	"url": "https://leetcode-cn.com/problems/max-sum-of-rectangle-no-larger-than-k/solution/ju-xing-qu-yu-bu-chao-guo-k-de-zui-da-sh-70q2/",
	"content": "#### æ–¹æ³•ä¸€ï¼šæœ‰åºé›†åˆ\n\n**æ€è·¯**\n\næˆ‘ä»¬æšä¸¾çŸ©å½¢çš„ä¸Šä¸‹è¾¹ç•Œï¼Œå¹¶è®¡ç®—å‡ºè¯¥è¾¹ç•Œå†…æ¯åˆ—çš„å…ƒç´ å’Œï¼Œåˆ™åŸé—®é¢˜è½¬æ¢æˆäº†å¦‚ä¸‹ä¸€ç»´é—®é¢˜ï¼š\n\n> ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œä¸€ä¸ªæ•´æ•° $k$ï¼Œè®¡ç®—è¯¥æ•°ç»„çš„æœ€å¤§åŒºé—´å’Œï¼Œè¦æ±‚åŒºé—´å’Œä¸è¶…è¿‡ $k$ã€‚\n\nå®šä¹‰é•¿åº¦ä¸º $n$ çš„æ•°ç»„ $a$ çš„å‰ç¼€å’Œ\n\n$$\nS_i =\n\\begin{cases} \n0&i=0\\\\\na_0+a_1+\\cdots+a_{i-1}&1\\le i\\le n\n\\end{cases}\n$$\n\nåˆ™åŒºé—´ $[l,r)$ çš„åŒºé—´å’Œ $a_l+a_{l+1}+\\cdots+a_{r-1}$ å¯ä»¥è¡¨ç¤ºä¸º $S_r-S_l$ã€‚\n\næšä¸¾ $r$ï¼Œä¸Šè¿°é—®é¢˜çš„çº¦æŸ $S_r-S_l\\le k$ å¯ä»¥è½¬æ¢ä¸º $S_l\\ge S_r-k$ã€‚è¦ä½¿ $S_r-S_l$ å°½å¯èƒ½å¤§ï¼Œåˆ™éœ€è¦å¯»æ‰¾æœ€å°çš„æ»¡è¶³ $S_l\\ge S_r-k$ çš„ $S_l$ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æšä¸¾ $r$ çš„åŒæ—¶ç»´æŠ¤ä¸€ä¸ªå­˜å‚¨ $S_i\\ (i<r)$ çš„æœ‰åºé›†åˆï¼Œåˆ™å¯ä»¥åœ¨ $O(\\log n)$ çš„æ—¶é—´å†…äºŒåˆ†æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„ $S_l$ã€‚\n\n**ä»£ç **\n\n```C++ [sol1-C++]\nclass Solution {\npublic:\n    int maxSumSubmatrix(vector<vector<int>> &matrix, int k) {\n        int ans = INT_MIN;\n        int m = matrix.size(), n = matrix[0].size();\n        for (int i = 0; i < m; ++i) { // æšä¸¾ä¸Šè¾¹ç•Œ\n            vector<int> sum(n);\n            for (int j = i; j < m; ++j) { // æšä¸¾ä¸‹è¾¹ç•Œ\n                for (int c = 0; c < n; ++c) {\n                    sum[c] += matrix[j][c]; // æ›´æ–°æ¯åˆ—çš„å…ƒç´ å’Œ\n                }\n                set<int> sumSet{0};\n                int s = 0;\n                for (int v : sum) {\n                    s += v;\n                    auto lb = sumSet.lower_bound(s - k);\n                    if (lb != sumSet.end()) {\n                        ans = max(ans, s - *lb);\n                    }\n                    sumSet.insert(s);\n                }\n            }\n        }\n        return ans;\n    }\n};\n```\n\n```Java [sol1-Java]\nclass Solution {\n    public int maxSumSubmatrix(int[][] matrix, int k) {\n        int ans = Integer.MIN_VALUE;\n        int m = matrix.length, n = matrix[0].length;\n        for (int i = 0; i < m; ++i) { // æšä¸¾ä¸Šè¾¹ç•Œ\n            int[] sum = new int[n];\n            for (int j = i; j < m; ++j) { // æšä¸¾ä¸‹è¾¹ç•Œ\n                for (int c = 0; c < n; ++c) {\n                    sum[c] += matrix[j][c]; // æ›´æ–°æ¯åˆ—çš„å…ƒç´ å’Œ\n                }\n                TreeSet<Integer> sumSet = new TreeSet<Integer>();\n                sumSet.add(0);\n                int s = 0;\n                for (int v : sum) {\n                    s += v;\n                    Integer ceil = sumSet.ceiling(s - k);\n                    if (ceil != null) {\n                        ans = Math.max(ans, s - ceil);\n                    }\n                    sumSet.add(s);\n                }\n            }\n        }\n        return ans;\n    }\n}\n```\n\n```go [sol1-Golang]\nimport \"math/rand\"\n\ntype node struct {\n    ch       [2]*node\n    priority int\n    val      int\n}\n\nfunc (o *node) cmp(b int) int {\n    switch {\n    case b < o.val:\n        return 0\n    case b > o.val:\n        return 1\n    default:\n        return -1\n    }\n}\n\nfunc (o *node) rotate(d int) *node {\n    x := o.ch[d^1]\n    o.ch[d^1] = x.ch[d]\n    x.ch[d] = o\n    return x\n}\n\ntype treap struct {\n    root *node\n}\n\nfunc (t *treap) _put(o *node, val int) *node {\n    if o == nil {\n        return &node{priority: rand.Int(), val: val}\n    }\n    if d := o.cmp(val); d >= 0 {\n        o.ch[d] = t._put(o.ch[d], val)\n        if o.ch[d].priority > o.priority {\n            o = o.rotate(d ^ 1)\n        }\n    }\n    return o\n}\n\nfunc (t *treap) put(val int) {\n    t.root = t._put(t.root, val)\n}\n\nfunc (t *treap) lowerBound(val int) (lb *node) {\n    for o := t.root; o != nil; {\n        switch c := o.cmp(val); {\n        case c == 0:\n            lb = o\n            o = o.ch[0]\n        case c > 0:\n            o = o.ch[1]\n        default:\n            return o\n        }\n    }\n    return\n}\n\nfunc maxSumSubmatrix(matrix [][]int, k int) int {\n    ans := math.MinInt64\n    for i := range matrix { // æšä¸¾ä¸Šè¾¹ç•Œ\n        sum := make([]int, len(matrix[0]))\n        for _, row := range matrix[i:] { // æšä¸¾ä¸‹è¾¹ç•Œ\n            for c, v := range row {\n                sum[c] += v // æ›´æ–°æ¯åˆ—çš„å…ƒç´ å’Œ\n            }\n            t := &treap{}\n            t.put(0)\n            s := 0\n            for _, v := range sum {\n                s += v\n                if lb := t.lowerBound(s - k); lb != nil {\n                    ans = max(ans, s-lb.val)\n                }\n                t.put(s)\n            }\n        }\n    }\n    return ans\n}\n\nfunc max(a, b int) int {\n    if a > b {\n        return a\n    }\n    return b\n}\n```\n\n```Python [sol1-Python3]\nfrom sortedcontainers import SortedList\n\nclass Solution:\n    def maxSumSubmatrix(self, matrix: List[List[int]], k: int) -> int:\n        ans = float(\"-inf\")\n        m, n = len(matrix), len(matrix[0])\n\n        for i in range(m):   # æšä¸¾ä¸Šè¾¹ç•Œ\n            total = [0] * n\n            for j in range(i, m):   # æšä¸¾ä¸‹è¾¹ç•Œ\n                for c in range(n):\n                    total[c] += matrix[j][c]   # æ›´æ–°æ¯åˆ—çš„å…ƒç´ å’Œ\n                \n                totalSet = SortedList([0])\n                s = 0\n                for v in total:\n                    s += v\n                    lb = totalSet.bisect_left(s - k)\n                    if lb != len(totalSet):\n                        ans = max(ans, s - totalSet[lb])\n                    totalSet.add(s)\n\n        return ans\n```\n\n**å¤æ‚åº¦åˆ†æ**\n\n- æ—¶é—´å¤æ‚åº¦ï¼š$O(m^2n\\log n)$ã€‚å…¶ä¸­ $m$ å’Œ $n$ åˆ†åˆ«æ˜¯çŸ©é˜µ $\\textit{matrix}$ çš„è¡Œæ•°å’Œåˆ—æ•°ã€‚\n\n- ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$ã€‚\n\n#### è¿›é˜¶é—®é¢˜\n\nå¯¹äºè¡Œæ•°è¿œå¤§äºåˆ—æ•°çš„æƒ…å†µï¼Œæšä¸¾çŸ©å½¢çš„å·¦å³è¾¹ç•Œæ›´ä¼˜ï¼Œå¯¹åº”çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n^2m\\log m)$ã€‚\n\næ€»ä¹‹ï¼Œæ ¹æ® $m$ å’Œ $n$ çš„å¤§å°æ¥ç»†åŒ–æšä¸¾ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥åšåˆ° $O(\\min(m,n)^2\\max(m,n)\\log\\max(m,n))$ çš„æ—¶é—´å¤æ‚åº¦ã€‚\n\n---\n# [ğŸ“š å¥½è¯»ä¹¦ï¼Ÿè¯»å¥½ä¹¦ï¼è®©æ—¶é—´æ›´æœ‰ä»·å€¼| ä¸–ç•Œè¯»ä¹¦æ—¥](https://leetcode-cn.com/circle/discuss/12QtuI/)\n4 æœˆ 22 æ—¥è‡³ 4 æœˆ 28 æ—¥ï¼Œè¿›å…¥ã€Œ[å­¦ä¹ ](https://leetcode-cn.com/leetbook/)ã€ï¼Œå®Œæˆé¡µé¢å³ä¸Šè§’çš„ã€Œè®©æ—¶é—´æ›´æœ‰ä»·å€¼ã€é™æ—¶é˜…è¯»ä»»åŠ¡ï¼Œå¯è·å¾—ã€Œ2021 è¯»ä¹¦æ—¥çºªå¿µå‹‹ç« ã€ã€‚æ›´å¤šæ´»åŠ¨è¯¦æƒ…æˆ³ä¸Šæ–¹æ ‡é¢˜äº†è§£æ›´å¤šğŸ‘†\n#### ä»Šæ—¥å­¦ä¹ ä»»åŠ¡ï¼š\n- ç†è§£å¤šæ€çš„æ¦‚å¿µ\n[å®Œæˆé˜…è¯» 2.4 å¤šæ€è®©æ¶ˆæ¯çš„å‘é€æ–¹æ³•é€šç”¨](https://leetcode-cn.com/leetbook/read/how-objects-work/o1dk4g/)\n- ç†è§£ç»“æ„åŒ–ç¼–ç¨‹\n[å®Œæˆé˜…è¯» 3.5 é‡è§†æ˜“æ‡‚æ€§çš„ç»“æ„åŒ–ç¼–ç¨‹](https://leetcode-cn.com/leetbook/read/how-objects-work/oy2zle/)\n\n"
}